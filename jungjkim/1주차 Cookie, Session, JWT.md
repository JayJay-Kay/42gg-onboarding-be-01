# 1주차 Cookie, Session, JWT

## 쿠키와 세션을 사용하는 이유

- HTTP환경은 “connectionless, stateless”특성을 가져서 서버는 클라이언트가 누구인지 매번 확인해야함
    - connectionless(비연결성)
        - 클라이언트가 요청을 한 후 응답을 받으면 그 연결을 끊어 버리는 특징
    - stateless(무상태성)
        - 통신이 끝나면 상태를 유지하지 않는 특징
- 쿠키와 세션은 위 두가지 특성을 해결하기 위해 사용
    - 쿠키와 세션을 사용하면 한번 로그인을 했을때 그 사용자에 대한 인증을 유지함

## 쿠키

- 정의
    - 클라이언트(브라우저) 로컬에 저장되는 키와 값이 들어있는 작은 데이터 파일
    - 클라이언트가 웹사이트를 방문할 경우, 그 사이트가 사용하고 있는 서버를 통해 클라이언트의 브라우저에 설치되는 작은 기록 정보 파일
    - Key-Value형식의 문자열로 이루어짐
    - 유효기간 있음 (서버가 정한 기간)
    - 사용예시: 자동 로그인, 쇼핑몰 장바구니 기능, 팝업에서 “더 이상 이창 보지 않음” 체크
- 구성요소
    - 이름
    - 값
    - 유효시간
    - 도메인
    - 경로
- 인증 방식
    1. 브라우저가 서버에 요청 보냄
    2. 서버는 클라이언트 측에 저장하고 싶은 정보를 response heade의 set-cookie에 담음
    3. 이후 해당 클라이언트의 요청을 보낼때마다 매번 저장된 cookie를 request header의 cookie에 담아서 보냄
- 단점
    - 보안에 취약(쿠키의 값을 그대로 보냄)
    - 용량 제한이 있음
    - 브라우저마다 쿠키에 대한 자원형태가 달라서 브라우저간 공유 불가

## 세션

- 비밀번호등 클라이언트의 민감한 인증 정보를 브라우저가 아닌 서버측에 저장하고 관리하기 위한 기술
- HTTP는 stateless(서버로 가는 모든 요청이 이전 요청과 독립적)
    - 메모리가 없음으로 유저의 정보를 기억하기 위해 Session ID를 사용
- 중요한 유저 정보는 모두 서버에 있음
- 유저가 가지고 있는 것은 오직 Session ID
- cookie는 그저 session ID를 전달하기 위한 매개체
    - 세션만 안쓰고 쿠키도 쓰는 이유는 서버의 자원을 효율적으로 쓰기 위해 (메모리 과부하 방지)

## 쿠키 vs 세션

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20Cookie,%20Session,%20JWT%2021f0c2746f714bbb9e7e9ed4ffeb0543/Untitled.png)

- 세션도 쿠키를 사용해서 동작원리는 비슷

## JWT(Json Web Token)

- 인증관련 정보를 암호화시킨 Token (Json 객체를 이용함)
- Session과 달리 서버가 아닌 클라이언트에 저장
- JWT 구조

![Untitled](1%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1%20Cookie,%20Session,%20JWT%2021f0c2746f714bbb9e7e9ed4ffeb0543/Untitled%201.png)

- Header: JWT에서 사용할 type, hash algorithm 종류
- Payload: 서버에서 첨부한 사용자 권한 정보와 데이터
- Signature: Header, Payload를 암호환 이후 Header에 명시된 해시함수를 적용하고 개인키로 서명한 전자서명

- 장점
    - 별도의 세션 저장소 불필요 (토큰 자체가 인증된 정보)
- 단점
    - 디코딩 가능해서 데이터 유출 발생 가능
    - 토큰 탈취 가능 (만료될 때까지 대처 불가